<ui:FluentWindow
    x:Class="FluentFrame.UI.Shell.FluentShell"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:cb="clr-namespace:CalcBinding;assembly=CalcBinding"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:local="clr-namespace:FluentFrame.UI.Shell"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:message="clr-namespace:FluentFrame.ViewModel.Shell.Message"
    xmlns:navigation="clr-namespace:FluentFrame.ViewModel.Shell.Navigation"
    xmlns:notify="clr-namespace:FluentFrame.ViewModel.Shell.Notify"
    xmlns:shell="clr-namespace:FluentFrame.ViewModel.Shell"
    xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
    Width="800"
    Height="450"
    MinWidth="600"
    MinHeight="450"
    d:DataContext="{d:DesignInstance Type=shell:FluentShellViewModel}"
    ExtendsContentIntoTitleBar="True"
    WindowBackdropType="Mica"
    WindowCornerPreference="Default"
    WindowStartupLocation="CenterScreen"
    mc:Ignorable="d">

    <ui:FluentWindow.Resources>

        <!--  导航菜单元素控件样式  -->
        <Style x:Key="VerticalItemsControlStyle" TargetType="ItemsControl">
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate>

                        <ScrollViewer
                            FocusVisualStyle="{x:Null}"
                            Focusable="False"
                            HorizontalScrollBarVisibility="Disabled"
                            VerticalScrollBarVisibility="Auto">
                            <ItemsPresenter />
                        </ScrollViewer>

                    </ControlTemplate>
                </Setter.Value>
            </Setter>
            <Setter Property="ItemsPanel">
                <Setter.Value>
                    <ItemsPanelTemplate>

                        <VirtualizingStackPanel
                            FocusVisualStyle="{x:Null}"
                            Focusable="False"
                            Orientation="Vertical" />

                    </ItemsPanelTemplate>
                </Setter.Value>
            </Setter>

            <Setter Property="Focusable" Value="False" />
            <Setter Property="FocusVisualStyle" Value="{x:Null}" />
        </Style>


        <!--  导航菜单元素模板  -->
        <DataTemplate DataType="{x:Type navigation:MenuItemViewModel}">
            <ui:Button
                Margin="3"
                HorizontalAlignment="Center"
                VerticalAlignment="Center"
                Command="{Binding DataContext.NavigationMenuItemClickedCommand, RelativeSource={RelativeSource AncestorType=local:FluentShell}}"
                CommandParameter="{Binding}"
                FocusVisualStyle="{x:Null}"
                Focusable="False">
                <ui:Button.Template>
                    <ControlTemplate TargetType="Button">

                        <Border
                            x:Name="MainBorder"
                            Width="{StaticResource PaneFluentButtonWidth}"
                            Height="{StaticResource PaneFluentButtonHeight}"
                            Padding="4"
                            HorizontalAlignment="Stretch"
                            d:DataContext="{d:DesignInstance Type=navigation:MenuItemViewModel}"
                            Background="Transparent"
                            BorderBrush="{TemplateBinding BorderBrush}"
                            BorderThickness="{TemplateBinding BorderThickness}"
                            CornerRadius="4"
                            FocusVisualStyle="{x:Null}"
                            Focusable="False">
                            <Grid>
                                <Rectangle
                                    x:Name="ActiveRectangle"
                                    Width="24"
                                    Height="3"
                                    Margin="0,0,0,-4"
                                    HorizontalAlignment="Center"
                                    VerticalAlignment="Bottom"
                                    Fill="{DynamicResource NavigationViewSelectionIndicatorForeground}"
                                    Opacity="0.0"
                                    RadiusX="2"
                                    RadiusY="2" />

                                <Grid HorizontalAlignment="Stretch" VerticalAlignment="Stretch">
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="*" />
                                        <RowDefinition Height="Auto" />
                                    </Grid.RowDefinitions>

                                    <ContentPresenter
                                        x:Name="IconContentPresenter"
                                        Grid.Row="0"
                                        Margin="0"
                                        Content="{Binding Icon}"
                                        TextElement.FontSize="{StaticResource NavigationViewFluentIconSize}"
                                        TextElement.Foreground="{DynamicResource NavigationViewItemForegroundLeftFluent}"
                                        Visibility="{cb:Binding 'Icon!=null'}" />

                                    <Grid
                                        x:Name="ContentGrid"
                                        Grid.Row="1"
                                        Height="{StaticResource NavigationViewFluentIconSize}"
                                        Margin="0,2,0,0">
                                        <ContentPresenter
                                            x:Name="ElementContentPresenter"
                                            HorizontalAlignment="Center"
                                            Content="{Binding Content}"
                                            TextElement.Foreground="{DynamicResource NavigationViewItemForegroundLeftFluent}" />
                                    </Grid>

                                    <!--<ContentPresenter
x:Name="PART_InfoBadge"
Grid.Row="0"
Margin="0"
HorizontalAlignment="Right"
VerticalAlignment="Top"
Content="{TemplateBinding InfoBadge}" />-->
                                </Grid>
                            </Grid>
                        </Border>

                        <ControlTemplate.Triggers>

                            <!--  选中动画  -->
                            <DataTrigger Binding="{Binding IsActive}" Value="True">
                                <Setter TargetName="ActiveRectangle" Property="Opacity" Value="1.0" />
                                <Setter TargetName="MainBorder" Property="Background" Value="{DynamicResource NavigationViewItemBackgroundSelectedLeftFluent}" />
                                <Setter TargetName="IconContentPresenter" Property="TextElement.Foreground" Value="{DynamicResource NavigationViewSelectionIndicatorForeground}" />
                                <Setter TargetName="ElementContentPresenter" Property="Margin" Value="0" />
                                <DataTrigger.EnterActions>
                                    <BeginStoryboard>
                                        <Storyboard>
                                            <DoubleAnimation
                                                Storyboard.TargetName="ContentGrid"
                                                Storyboard.TargetProperty="Height"
                                                From="{StaticResource NavigationViewFluentIconSize}"
                                                To="0"
                                                Duration="0:0:.16" />
                                            <DoubleAnimation
                                                Storyboard.TargetName="ContentGrid"
                                                Storyboard.TargetProperty="Opacity"
                                                From="1"
                                                To="0"
                                                Duration="0:0:.16" />
                                            <DoubleAnimation
                                                Storyboard.TargetName="MainBorder"
                                                Storyboard.TargetProperty="(Border.BorderBrush).(SolidColorBrush.Opacity)"
                                                From="0"
                                                To="1"
                                                Duration="0:0:.16" />
                                        </Storyboard>
                                    </BeginStoryboard>
                                </DataTrigger.EnterActions>
                                <DataTrigger.ExitActions>
                                    <BeginStoryboard>
                                        <Storyboard>
                                            <DoubleAnimation
                                                Storyboard.TargetName="ContentGrid"
                                                Storyboard.TargetProperty="Height"
                                                From="0"
                                                To="{StaticResource NavigationViewFluentIconSize}"
                                                Duration="0:0:.16" />
                                            <DoubleAnimation
                                                Storyboard.TargetName="ContentGrid"
                                                Storyboard.TargetProperty="Opacity"
                                                From="0"
                                                To="1"
                                                Duration="0:0:.16" />
                                            <DoubleAnimation
                                                Storyboard.TargetName="MainBorder"
                                                Storyboard.TargetProperty="(Border.BorderBrush).(SolidColorBrush.Opacity)"
                                                From="1"
                                                To="0"
                                                Duration="0:0:.16" />
                                        </Storyboard>
                                    </BeginStoryboard>
                                </DataTrigger.ExitActions>
                            </DataTrigger>

                            <!--  鼠标进入  -->
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="MainBorder" Property="Background" Value="{DynamicResource NavigationViewItemBackgroundSelectedLeftFluent}" />
                            </Trigger>

                            <!--  鼠标进入且不是活跃状态  -->
                            <MultiDataTrigger>

                                <MultiDataTrigger.Conditions>
                                    <Condition Binding="{Binding IsMouseOver, RelativeSource={RelativeSource AncestorType=Button}}" Value="True" />
                                    <Condition Binding="{Binding IsActive}" Value="False" />
                                </MultiDataTrigger.Conditions>

                                <MultiDataTrigger.Setters>
                                    <Setter TargetName="IconContentPresenter" Property="TextElement.Foreground" Value="{DynamicResource NavigationViewItemForegroundPointerOverLeftFluent}" />
                                    <Setter TargetName="ContentGrid" Property="TextElement.Foreground" Value="{DynamicResource NavigationViewItemForegroundPointerOverLeftFluent}" />
                                </MultiDataTrigger.Setters>

                            </MultiDataTrigger>

                        </ControlTemplate.Triggers>

                    </ControlTemplate>
                </ui:Button.Template>
            </ui:Button>
        </DataTemplate>

        <!--  导航记录元素模板  -->
        <DataTemplate DataType="{x:Type navigation:RecordItemViewModel}">
            <StackPanel VerticalAlignment="Center">

                <Button
                    Background="Transparent"
                    BorderThickness="0"
                    Command="{Binding DataContext.NavigationRecordItemClickedCommand, RelativeSource={RelativeSource AncestorType=local:FluentShell}}"
                    CommandParameter="{Binding}">
                    <StackPanel Orientation="Horizontal">
                        <ContentPresenter
                            Margin="0,0,0,5"
                            VerticalAlignment="Center"
                            Content="{Binding Icon}" />

                        <ContentPresenter VerticalAlignment="Center" Content="{Binding Content}" />
                    </StackPanel>
                </Button>

            </StackPanel>
        </DataTemplate>

        <!--  消息元素模板  -->
        <DataTemplate DataType="{x:Type message:MessageItemViewModel}">
            <ui:InfoBar
                Title="{Binding Title}"
                Margin="3"
                Content="{Binding Content}"
                IsClosable="True"
                IsOpen="True"
                Severity="{Binding Severity}" />
        </DataTemplate>

        <!--  通知元素模板  -->
        <DataTemplate DataType="{x:Type notify:NotifyItemViewModel}">

            <ContentControl Content="{Binding}">
                <ContentControl.Template>
                    <ControlTemplate>

                        <!--  模板  -->
                        <ui:Button
                            x:Name="RootButton"
                            HorizontalAlignment="Right"
                            Appearance="{Binding Appearance}"
                            Icon="{Binding Icon}">
                            <DockPanel Margin="5">

                                <!--  关闭按钮  -->
                                <ui:Button
                                    VerticalAlignment="Center"
                                    Background="Transparent"
                                    BorderThickness="0"
                                    Command="{Binding DataContext.CloseNotifyItemClickedCommand, RelativeSource={RelativeSource AncestorType=ui:FluentWindow}}"
                                    CommandParameter="{Binding}"
                                    DockPanel.Dock="Right"
                                    FocusVisualStyle="{x:Null}"
                                    Focusable="False">
                                    <ui:SymbolIcon Symbol="Dismiss24" />
                                </ui:Button>

                                <!--  内容  -->
                                <StackPanel VerticalAlignment="Center">
                                    <ui:TextBlock FontTypography="BodyStrong" Text="{Binding Title}" />
                                    <ContentControl Margin="0,5,0,0" Content="{Binding Content}" />
                                </StackPanel>

                            </DockPanel>

                            <ui:Button.LayoutTransform>
                                <ScaleTransform x:Name="ScaleTransform" ScaleX="0" />
                            </ui:Button.LayoutTransform>

                        </ui:Button>

                        <!--  触发器  -->
                        <ControlTemplate.Triggers>

                            <DataTrigger Binding="{Binding IsActive}" Value="True">
                                <DataTrigger.EnterActions>
                                    <BeginStoryboard>
                                        <Storyboard>
                                            <DoubleAnimation
                                                Storyboard.TargetName="ScaleTransform"
                                                Storyboard.TargetProperty="ScaleX"
                                                From="0"
                                                To="1"
                                                Duration="0:0:.15" />
                                        </Storyboard>
                                    </BeginStoryboard>
                                </DataTrigger.EnterActions>

                                <DataTrigger.ExitActions>
                                    <BeginStoryboard>
                                        <Storyboard>
                                            <DoubleAnimation
                                                Storyboard.TargetName="ScaleTransform"
                                                Storyboard.TargetProperty="ScaleX"
                                                From="1"
                                                To="0"
                                                Duration="0:0:.1" />
                                        </Storyboard>
                                    </BeginStoryboard>
                                </DataTrigger.ExitActions>
                            </DataTrigger>

                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </ContentControl.Template>
            </ContentControl>

        </DataTemplate>

    </ui:FluentWindow.Resources>

    <Grid>

        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition />
        </Grid.RowDefinitions>

        <!--  标题栏  -->
        <ui:TitleBar
            Title="{Binding Title}"
            Grid.Row="0"
            DockPanel.Dock="Top"
            Icon="{Binding Icon}" />

        <DockPanel Grid.Row="1">
            <!--  导航菜单  -->
            <DockPanel
                Margin="5"
                HorizontalAlignment="Center"
                DockPanel.Dock="Left">

                <!--  页脚  -->
                <ItemsControl
                    d:ItemsSource="{d:SampleData ItemCount=2}"
                    DockPanel.Dock="Bottom"
                    ItemsSource="{Binding NavigationFooterMenus}"
                    Style="{StaticResource VerticalItemsControlStyle}" />

                <!--  正常  -->
                <ItemsControl
                    d:ItemsSource="{d:SampleData ItemCount=4}"
                    ItemsSource="{Binding NavigationMenus}"
                    Style="{StaticResource VerticalItemsControlStyle}" />

            </DockPanel>

            <!--  内容  -->
            <DockPanel
                MinWidth="450"
                MinHeight="400"
                Margin="20"
                HorizontalAlignment="Center">

                <!--  功能栏  -->
                <DockPanel DockPanel.Dock="Top">

                    <!--  夜间模式  -->
                    <ui:ToggleSwitch
                        Margin="5"
                        VerticalAlignment="Center"
                        Background="Transparent"
                        BorderThickness="0"
                        DockPanel.Dock="Right"
                        FocusVisualStyle="{x:Null}"
                        Focusable="False"
                        IsChecked="{Binding IsDarkTheme}">

                        <ui:ToggleSwitch.Template>
                            <ControlTemplate TargetType="ui:ToggleSwitch">
                                <ContentControl
                                    x:Name="IconPresenter"
                                    HorizontalAlignment="Center"
                                    VerticalAlignment="Center" />

                                <ControlTemplate.Triggers>
                                    <Trigger Property="IsChecked" Value="True">
                                        <Setter TargetName="IconPresenter" Property="Content">
                                            <Setter.Value>
                                                <ui:SymbolIcon Symbol="WeatherMoon24" />
                                            </Setter.Value>
                                        </Setter>
                                    </Trigger>

                                    <Trigger Property="IsChecked" Value="False">
                                        <Setter TargetName="IconPresenter" Property="Content">
                                            <Setter.Value>
                                                <ui:SymbolIcon Symbol="WeatherSunny24" />
                                            </Setter.Value>
                                        </Setter>
                                    </Trigger>
                                </ControlTemplate.Triggers>
                            </ControlTemplate>
                        </ui:ToggleSwitch.Template>

                    </ui:ToggleSwitch>

                    <!--  消息  -->
                    <ui:ToggleSwitch
                        x:Name="MessageSwitch"
                        Margin="5"
                        Content="消息"
                        DockPanel.Dock="Right"
                        FocusVisualStyle="{x:Null}"
                        Focusable="False">
                        <ui:ToggleSwitch.Template>
                            <ControlTemplate>

                                <ui:SymbolIcon Symbol="Alert24" />

                            </ControlTemplate>
                        </ui:ToggleSwitch.Template>
                    </ui:ToggleSwitch>

                    <!--  返回  -->
                    <ui:Button
                        Margin="5"
                        VerticalAlignment="Center"
                        Background="Transparent"
                        BorderThickness="0"
                        DockPanel.Dock="Left"
                        FocusVisualStyle="{x:Null}"
                        Focusable="False">
                        <ui:Button.Icon>
                            <ui:SymbolIcon Symbol="ArrowLeft48" />
                        </ui:Button.Icon>
                    </ui:Button>


                    <!--  导航路径  -->
                    <ui:BreadcrumbBar x:Name="BreadcrumbBar" ItemsSource="{Binding NavigationRecords}" />

                </DockPanel>

                <!--  页面布局范围  -->
                <Grid>

                    <!--  内容  -->
                    <ContentPresenter Margin="5" Content="{Binding Content}" />

                    <!--  消息列表弹窗  -->
                    <Popup
                        x:Name="FloatingPopup"
                        MaxHeight="1000"
                        AllowsTransparency="True"
                        IsOpen="{Binding IsChecked, ElementName=MessageSwitch}"
                        Placement="Bottom"
                        PlacementTarget="{Binding ElementName=MessageSwitch}"
                        StaysOpen="False">

                        <ui:Card>
                            <ItemsControl
                                HorizontalAlignment="Center"
                                VerticalContentAlignment="Center"
                                ItemsSource="{Binding Messages}"
                                Style="{StaticResource VerticalItemsControlStyle}" />
                        </ui:Card>


                    </Popup>
                </Grid>

            </DockPanel>
        </DockPanel>

        <!--  通知  -->
        <ItemsControl
            Grid.Row="1"
            Margin="5"
            HorizontalAlignment="Right"
            VerticalAlignment="Bottom"
            d:ItemsSource="{d:SampleData ItemCount=5}"
            ItemsSource="{Binding Notifies}"
            Style="{StaticResource VerticalItemsControlStyle}" />

    </Grid>
</ui:FluentWindow>
