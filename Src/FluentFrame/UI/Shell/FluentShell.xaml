<ui:FluentWindow
    x:Class="FluentFrame.UI.Shell.FluentShell"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:cb="clr-namespace:CalcBinding;assembly=CalcBinding"
    xmlns:controls="clr-namespace:FluentFrame.UI.Shell.Controls"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:local="clr-namespace:FluentFrame.UI.Shell"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:message="clr-namespace:FluentFrame.ViewModel.Shell.Message"
    xmlns:navigation="clr-namespace:FluentFrame.ViewModel.Shell.Navigation"
    xmlns:notify="clr-namespace:FluentFrame.ViewModel.Shell.Notify"
    xmlns:shell="clr-namespace:FluentFrame.ViewModel.Shell"
    xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
    Width="800"
    Height="450"
    MinWidth="600"
    MinHeight="450"
    d:DataContext="{d:DesignInstance Type=shell:FluentShellViewModel}"
    ExtendsContentIntoTitleBar="True"
    WindowBackdropType="Mica"
    WindowCornerPreference="Default"
    WindowStartupLocation="CenterScreen"
    mc:Ignorable="d">

    <ui:FluentWindow.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>

                <ResourceDictionary Source="pack://application:,,,/FluentFrame;component/UI/Shell/FluentShell.Resource.xaml" />
                <ResourceDictionary Source="pack://application:,,,/FluentFrame;component/UI/Shell/Controls/MessagePopupBox.xaml" />

            </ResourceDictionary.MergedDictionaries>
        </ResourceDictionary>
    </ui:FluentWindow.Resources>

    <!--  布局  -->
    <Grid>

        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition />
        </Grid.RowDefinitions>

        <!--  标题栏  -->
        <ui:TitleBar
            Title="{Binding Title}"
            Grid.Row="0"
            DockPanel.Dock="Top"
            Icon="{Binding Icon}" />

        <!--  内容  -->
        <DockPanel
            Grid.Row="1"
            IsHitTestVisible="{cb:Binding 'Dialog==null'}"
            Opacity="{Binding ContentOpacity}">

            <!--  导航菜单  -->
            <DockPanel
                Margin="5"
                HorizontalAlignment="Center"
                DockPanel.Dock="Left">

                <!--  页脚  -->
                <ItemsControl
                    d:ItemsSource="{d:SampleData ItemCount=2}"
                    DockPanel.Dock="Bottom"
                    ItemsSource="{Binding NavigationFooterMenus}"
                    Style="{StaticResource NavigationMenuItemControlStyle}" />

                <!--  正常  -->
                <ItemsControl
                    d:ItemsSource="{d:SampleData ItemCount=4}"
                    ItemsSource="{Binding NavigationMenus}"
                    Style="{StaticResource NavigationMenuItemControlStyle}" />

            </DockPanel>

            <!--  内容  -->
            <DockPanel
                MinWidth="450"
                Margin="10"
                HorizontalAlignment="Center">

                <!--  功能栏  -->
                <DockPanel DockPanel.Dock="Top">

                    <!--  夜间模式  -->
                    <ToggleButton
                        DockPanel.Dock="Right"
                        IsChecked="{Binding IsDarkTheme}"
                        Style="{StaticResource DarkModeDarkModeToggleButtonStyle}" />

                    <Grid DockPanel.Dock="Right">

                        <!--  消息数量  -->
                        <ContentPresenter
                            Content="{Binding Messages.Count}"
                            ContentTemplate="{StaticResource MessageCountDateTempalte}"
                            Visibility="{cb:Binding MessageCountVisible}" />

                        <!--  消息通知弹窗开关  -->
                        <ToggleButton
                            x:Name="MessageSwitch"
                            d:Visibility="{cb:Binding 'Messages.Count != 0'}"
                            IsChecked="{Binding MessagePopupOpened}"
                            Style="{StaticResource MessagePopupToggleButtonStyle}" />


                        <!--  消息列表弹窗  -->
                        <Popup
                            IsOpen="{Binding MessagePopupOpened}"
                            PlacementTarget="{Binding ElementName=MessageSwitch}"
                            Style="{StaticResource MessagePopupStyle}"
                            Visibility="{cb:Binding MessageCountVisible}">

                            <ui:Card Background="{DynamicResource ApplicationBackgroundBrush}">
                                <ItemsControl
                                    d:ItemsSource="{d:SampleData ItemCount=3}"
                                    ItemsSource="{Binding Messages}"
                                    Style="{StaticResource MessageItemsControlStyle}" />
                            </ui:Card>

                        </Popup>

                    </Grid>

                    <!--  导航返回  -->
                    <ui:Button
                        Margin="5"
                        Command="{Binding NavigationBackCommand}"
                        DockPanel.Dock="Left"
                        Icon="{ui:SymbolIcon Symbol=ArrowLeft24}"
                        IsEnabled="{Binding NavigationBackEnable}" />

                    <!--  导航前进  -->
                    <ui:Button
                        Margin="5"
                        Command="{Binding NavigationForwardCommand}"
                        DockPanel.Dock="Left"
                        Icon="{ui:SymbolIcon Symbol=ArrowRight24}"
                        IsEnabled="{Binding NavigationForwardEnable}" />

                    <!--  导航路径  -->
                    <ui:BreadcrumbBar
                        x:Name="BreadcrumbBar"
                        ItemTemplate="{StaticResource NavigationRecordItemDataTemplate}"
                        ItemsSource="{Binding NavigationRecords}" />

                </DockPanel>

                <!--  页面内容  -->
                <ContentPresenter Margin="5" Content="{Binding Content}" />

            </DockPanel>

        </DockPanel>

        <!--  弹窗  -->
        <ContentControl
            Grid.Row="1"
            Content="{Binding Dialog}"
            ContentTemplate="{StaticResource DialogDataTemplate}"
            Visibility="{cb:Binding Dialog.IsActive}" />

        <!--  通知  -->
        <ItemsControl
            Grid.Row="1"
            d:ItemsSource="{d:SampleData ItemCount=5}"
            ItemsSource="{Binding Notifies}"
            Style="{StaticResource NotifyItemsControlStyle}" />

    </Grid>
</ui:FluentWindow>
